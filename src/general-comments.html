<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Legg inn generell kommentar</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="${cssPath}" />
  </head>
  <body>
    <h3>Legg inn generell kommentar</h3>
    <div id="rubricContainer"></div>
    <br />
    <button
      type="button"
      class="btn btn-secondary btn-sm"
      onclick="saveDraft()"
    >
      Lagre utkast
    </button>
    <button type="button" class="btn btn-primary btn-sm">Send inn</button>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script>
      // document.addEventListener("DOMContentLoaded", function () {
      //   console.log("helluu");
      //   // Fetch the JSON data
      //   fetch("../rubrics.json") ///Users/Ingri/Documents/collabrate/rubrics.json
      //     .then((response) => response.json())
      //     .then((data) => {
      //       // Assuming only one rubric for simplicity, you can modify it for multiple rubrics
      //       const rubric = data.rubrics[0];

      //       // Update the HTML content
      //       document.getElementById("rubricTitle").innerText = rubric.title;
      //       document.getElementById("rubricDescription").innerText =
      //         rubric.description;
      //     })
      //     .catch((error) => console.error("Error fetching JSON:", error));
      // });

      window.addEventListener("message", (event) => {
        console.log("klart");
        const message = event.data;
        const rubricsJson = message.data;
        const rubricsContainer = document.getElementById("rubricContainer");
        // if (message.command === "webviewReady") {
        //   // Perform actions when the webview view is ready
        //   console.log("webview is ready");
        if (message.command === "rubricsJson") {
          if (
            rubricsJson &&
            rubricsJson.rubrics.length > 0 &&
            Array.isArray(rubricsJson.rubrics)
          ) {
            rubricsContainer.innerHTML = "";
            rubricsJson.rubrics.forEach((rubric) => {
              const rubricElement = document.createElement("div");
              rubricElement.innerHTML = `
                <div class="rubric">
                  <h4 id="rubricTitle">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="13"
                      height="13"
                      fill="currentColor"
                      class="bi bi-search"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"
                      />
                    </svg>
                    ${rubric.title}
                  </h4>
                  <p id="rubricDescription">
                    ${rubric.description}
                  </p>
                  <textarea
                    class="commentBox"
                    placeholder="Skriv her."
                    cols="40"
                    rows="4"
                  ></textarea
                  ><br />

                  <div class="flex-container">
                    <div class="radio-button-group">
                      <label class="container"
                        >1
                        <input class="radio-button" type="radio" name="radio" />
                        <span class="checkmark"></span>
                      </label>

                      <label class="container"
                        >2
                        <input class="radio-button" type="radio" name="radio" />
                        <span class="checkmark"></span>
                      </label>

                      <label class="container"
                        >3
                        <input class="radio-button" type="radio" name="radio" />
                        <span class="checkmark"></span>
                      </label>

                      <label class="container"
                        >4
                        <input class="radio-button" type="radio" name="radio" />
                        <span class="checkmark"></span>
                      </label>

                      <label class="container"
                        >5
                        <input class="radio-button" type="radio" name="radio" />
                        <span class="checkmark"></span>
                      </label>
                    </div>
                  </div>
              </div>
              <br />
              `;
              rubricsContainer.appendChild(rubricElement);
            });
          }
        }
      });

      function saveDraft() {
        const vscode = acquireVsCodeApi();
        let rubrics = Array.from(document.getElementsByClassName("rubric"));
        for (let i = 0; i < rubrics.length; i++) {
          const textarea = Array.from(rubrics[i].children)[1];
          const text = textarea.value;
          vscode.postMessage({ command: "getGeneral" + i, text: text });
        }
      }
    </script>
  </body>
</html>
